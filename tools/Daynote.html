<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YSun ã® æ—¥è®°</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #5a67d8;
            --secondary: #764ba2;
            --accent: #f093fb;
            --success: #38ef7d;
            --danger: #f5576c;
            --warning: #ffecd2;
            --bg-dark: #1a1a2e;
            --bg-card: rgba(255, 255, 255, 0.05);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-muted: rgba(255, 255, 255, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: var(--text-primary);
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        /* åŠ¨æ€èƒŒæ™¯ */
        .bg-gradient {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(102, 126, 234, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(118, 75, 162, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(240, 147, 251, 0.1) 0%, transparent 40%);
            z-index: 0;
            animation: bgShift 20s ease-in-out infinite;
        }

        @keyframes bgShift {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* æµ®åŠ¨ç²’å­ */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            opacity: 0.3;
            animation: floatUp 15s infinite;
        }

        @keyframes floatUp {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.3; }
            90% { opacity: 0.3; }
            100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; }
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
        }

        /* é¡µé¢å¤´éƒ¨ */
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 20px;
        }

        .logo {
            font-size: 3rem;
            margin-bottom: 15px;
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-shadow: 0 0 40px rgba(102, 126, 234, 0.5);
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 300;
        }

        /* å¯†ç å±‚ */
        #password-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #0f3460 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(20px);
        }

        .login-box {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            backdrop-filter: blur(20px);
            padding: 50px;
            border-radius: 24px;
            border: 1px solid rgba(255,255,255,0.1);
            text-align: center;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
        }

        .login-box h2 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .login-box p {
            color: var(--text-secondary);
            margin-bottom: 25px;
        }

        .login-box input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            font-size: 16px;
            background: rgba(255,255,255,0.05);
            color: white;
            outline: none;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .login-box input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }

        .login-box button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .login-box button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        #error-msg {
            color: var(--danger);
            margin-top: 15px;
            font-size: 14px;
        }

        .container.locked {
            filter: blur(10px);
            pointer-events: none;
        }

        /* ç¼–è¾‘å™¨é¢æ¿ */
        #editor-panel {
            display: none;
            background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            padding: 30px;
            margin-bottom: 30px;
            animation: slideDown 0.4s ease-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .editor-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .editor-header h2 {
            font-size: 1.5rem;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .editor-header .icon {
            font-size: 2rem;
        }

        #diary-title {
            width: 100%;
            padding: 18px 20px;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            font-size: 18px;
            font-weight: 500;
            background: rgba(255,255,255,0.05);
            color: white;
            outline: none;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        #diary-title:focus {
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.2);
        }

        #diary-content {
            width: 100%;
            min-height: 180px;
            padding: 18px 20px;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            font-size: 16px;
            font-family: inherit;
            line-height: 1.8;
            background: rgba(255,255,255,0.05);
            color: white;
            outline: none;
            resize: vertical;
            transition: all 0.3s;
        }

        #diary-content:focus {
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.2);
        }

        /* å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ */
        .image-upload-area {
            margin: 20px 0;
            padding: 30px;
            border: 2px dashed rgba(255,255,255,0.2);
            border-radius: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(255,255,255,0.02);
        }

        .image-upload-area:hover {
            border-color: var(--primary);
            background: rgba(102, 126, 234, 0.1);
        }

        .image-upload-area.has-image {
            border-style: solid;
            border-color: var(--success);
        }

        .image-upload-area .upload-icon {
            font-size: 3rem;
            margin-bottom: 10px;
            opacity: 0.6;
        }

        .image-upload-area p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        #image-preview {
            max-width: 100%;
            max-height: 300px;
            border-radius: 12px;
            margin-top: 15px;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .image-upload-area input[type="file"] {
            display: none;
        }

        /* æŒ‰é’®ç»„ */
        .editor-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 50px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: var(--text-secondary);
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.15);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #ff6b6b);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(245, 87, 108, 0.4);
        }

        /* çŠ¶æ€æç¤º */
        #upload-status {
            margin-top: 20px;
            padding: 15px 20px;
            border-radius: 12px;
            display: none;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        #upload-status.success {
            background: linear-gradient(135deg, rgba(56, 239, 125, 0.2), rgba(17, 153, 142, 0.2));
            border: 1px solid rgba(56, 239, 125, 0.3);
            color: var(--success);
        }

        #upload-status.error {
            background: linear-gradient(135deg, rgba(245, 87, 108, 0.2), rgba(255, 107, 107, 0.2));
            border: 1px solid rgba(245, 87, 108, 0.3);
            color: var(--danger);
        }

        #upload-status.loading {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
            border: 1px solid rgba(102, 126, 234, 0.3);
            color: var(--primary);
        }

        /* æ—¥è®°æ¡ç›® */
        .diary-entry {
            background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            margin-bottom: 20px;
            overflow: hidden;
            transition: all 0.3s;
        }

        .diary-entry:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .diary-entry.new-entry {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.1));
            border: 2px solid rgba(102, 126, 234, 0.4);
        }

        .entry-header {
            padding: 20px 25px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }

        .entry-header:hover {
            background: rgba(255,255,255,0.05);
        }

        .entry-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .entry-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: white;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .entry-title .has-image {
            width: 8px;
            height: 8px;
            background: var(--accent);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .entry-meta {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .entry-date {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .entry-tag {
            font-size: 0.7rem;
            padding: 3px 10px;
            border-radius: 20px;
            font-weight: 500;
        }

        .tag-new {
            background: linear-gradient(135deg, var(--success), #11998e);
            color: white;
        }

        .tag-has-image {
            background: linear-gradient(135deg, var(--accent), var(--secondary));
            color: white;
        }

        .entry-toggle {
            font-size: 1.5rem;
            color: var(--text-muted);
            transition: transform 0.3s;
        }

        .diary-entry.open .entry-toggle {
            transform: rotate(45deg);
        }

        .entry-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out;
        }

        .diary-entry.open .entry-content {
            max-height: 1000px;
        }

        .entry-body {
            padding: 0 25px 25px;
        }

        .entry-image {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .entry-text {
            color: var(--text-secondary);
            line-height: 1.8;
            font-size: 1rem;
        }

        .entry-text p {
            margin-bottom: 15px;
        }

        .entry-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .entry-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .entry-btn-edit {
            background: rgba(102, 126, 234, 0.2);
            color: var(--primary);
        }

        .entry-btn-edit:hover {
            background: rgba(102, 126, 234, 0.3);
        }

        .entry-btn-delete {
            background: rgba(245, 87, 108, 0.2);
            color: var(--danger);
        }

        .entry-btn-delete:hover {
            background: rgba(245, 87, 108, 0.3);
        }

        /* æ— å›¾ç‰‡å ä½ */
        .no-image-placeholder {
            background: linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            margin-bottom: 20px;
            border: 1px dashed rgba(255,255,255,0.1);
        }

        .no-image-placeholder .icon {
            font-size: 3rem;
            opacity: 0.3;
            margin-bottom: 10px;
        }

        .no-image-placeholder p {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* æ‚¬æµ®æŒ‰é’® */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 65px;
            height: 65px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
            transition: all 0.3s;
            z-index: 100;
            display: none;
        }

        .fab:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
        }

        .fab.active {
            background: linear-gradient(135deg, var(--danger), #ff6b6b);
            transform: rotate(45deg);
        }

        .fab.active:hover {
            transform: scale(1.1) rotate(135deg);
        }

        /* é¡µè„š */
        footer {
            text-align: center;
            padding: 40px 0 20px;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        footer span {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* åˆ é™¤ç¡®è®¤æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(30,30,50,0.95), rgba(20,20,40,0.95));
            padding: 40px;
            border-radius: 24px;
            border: 1px solid rgba(255,255,255,0.1);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .modal-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .modal-text {
            color: var(--text-secondary);
            margin-bottom: 25px;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* å›¾ç‰‡é¢„è§ˆå¼¹çª— */
        .image-lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 3000;
            cursor: zoom-out;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .image-lightbox img {
            max-width: 95%;
            max-height: 95%;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: zoomIn 0.3s ease-out;
        }

        @keyframes zoomIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 2.5rem;
            color: white;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.3s;
            z-index: 3001;
        }

        .lightbox-close:hover {
            opacity: 1;
        }

        /* å¯ç‚¹å‡»æŸ¥çœ‹çš„å›¾ç‰‡ */
        .entry-image {
            cursor: zoom-in;
            transition: transform 0.3s;
        }

        .entry-image:hover {
            transform: scale(1.02);
        }

        /* ä¸Šä¼ è¿›åº¦ */
        .upload-progress {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            margin-top: 15px;
            overflow: hidden;
            display: none;
        }

        .upload-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 3px;
            transition: width 0.3s;
            animation: progressPulse 1.5s infinite;
        }

        @keyframes progressPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* æ—¥è®°å·¥å…·æ  */
        .diary-toolbar {
            background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stats-bar {
            display: flex;
            gap: 25px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-icon {
            font-size: 1.3rem;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent);
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .search-box input {
            padding: 12px 18px;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 50px;
            font-size: 14px;
            background: rgba(255,255,255,0.05);
            color: white;
            outline: none;
            width: 200px;
            transition: all 0.3s;
        }

        .search-box input:focus {
            border-color: var(--primary);
            width: 250px;
        }

        .search-box input::placeholder {
            color: var(--text-muted);
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 30px;
            background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
            border-radius: 24px;
            border: 2px dashed rgba(255,255,255,0.1);
        }

        .empty-icon {
            font-size: 5rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .empty-state p {
            color: var(--text-muted);
        }

        /* å“åº”å¼ */
        @media (max-width: 600px) {
            h1 { font-size: 1.8rem; }
            .login-box { padding: 30px; }
            .editor-actions { flex-direction: column; }
            .btn { width: 100%; justify-content: center; }
            .fab { bottom: 20px; right: 20px; width: 55px; height: 55px; font-size: 1.5rem; }
            .entry-header { padding: 15px 20px; }
            .entry-body { padding: 0 20px 20px; }
            .lightbox-close { top: 10px; right: 15px; font-size: 2rem; }
            .diary-toolbar { flex-direction: column; align-items: stretch; }
            .stats-bar { justify-content: space-around; }
            .search-box input { width: 100%; }
            .search-box input:focus { width: 100%; }
        }
    </style>
</head>
<body>

<div class="bg-gradient"></div>
<div class="particles">
    <div class="particle" style="left: 10%; animation-delay: 0s;"></div>
    <div class="particle" style="left: 20%; animation-delay: 2s;"></div>
    <div class="particle" style="left: 35%; animation-delay: 4s;"></div>
    <div class="particle" style="left: 50%; animation-delay: 1s;"></div>
    <div class="particle" style="left: 65%; animation-delay: 3s;"></div>
    <div class="particle" style="left: 80%; animation-delay: 5s;"></div>
    <div class="particle" style="left: 90%; animation-delay: 2.5s;"></div>
</div>

<!-- å¯†ç å±‚ -->
<div id="password-overlay">
    <div class="login-box">
        <h2>ğŸ” ç§å¯†ç©ºé—´</h2>
        <p>è¾“å…¥å¯†ç è§£é”ä½ çš„æ—¥è®°</p>
        <input type="password" id="password-input" placeholder="è¯·è¾“å…¥å¯†ç " onkeypress="if(event.keyCode==13) checkPassword()">
        <button onclick="checkPassword()">è§£é”</button>
        <p id="error-msg" style="display: none;">å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•</p>
    </div>
</div>

<!-- åˆ é™¤ç¡®è®¤æ¨¡æ€æ¡† -->
<div class="modal" id="delete-modal">
    <div class="modal-content">
        <div class="modal-icon">âš ï¸</div>
        <h3 class="modal-title">ç¡®è®¤åˆ é™¤ï¼Ÿ</h3>
        <p class="modal-text">åˆ é™¤åæ— æ³•æ¢å¤ï¼Œç¡®å®šè¦åˆ é™¤è¿™ç¯‡æ—¥è®°å—ï¼Ÿ</p>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closeDeleteModal()">å–æ¶ˆ</button>
            <button class="btn btn-danger" onclick="confirmDelete()">åˆ é™¤</button>
        </div>
    </div>
</div>

<!-- å›¾ç‰‡é¢„è§ˆå¼¹çª— -->
<div class="image-lightbox" id="image-lightbox" onclick="closeLightbox()">
    <span class="lightbox-close" onclick="closeLightbox()">âœ•</span>
    <img id="lightbox-image" src="" alt="å›¾ç‰‡é¢„è§ˆ">
</div>

<div class="container locked" id="main-content">
    <header>
        <div class="logo">ğŸ“”</div>
        <h1>YSun ã® æ—¥è®°</h1>
        <p class="subtitle">è®°å½•ç”Ÿæ´»ä¸­çš„ç‚¹æ»´æ€è€ƒä¸æˆé•¿</p>
    </header>

    <!-- ç¼–è¾‘å™¨ -->
    <div id="editor-panel">
        <div class="editor-header">
            <span class="icon">âœ¨</span>
            <h2 id="editor-title">å†™æ–°æ—¥è®°</h2>
        </div>
        
        <input type="text" id="diary-title" placeholder="ä»Šå¤©æƒ³å†™ç‚¹ä»€ä¹ˆï¼Ÿ">
        <textarea id="diary-content" placeholder="åœ¨è¿™é‡Œè®°å½•ä½ çš„æƒ³æ³•..."></textarea>
        
        <div class="image-upload-area" id="image-upload" onclick="document.getElementById('image-input').click()">
            <div class="upload-icon">ğŸ–¼ï¸</div>
            <p>ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰</p>
            <input type="file" id="image-input" accept="image/*" onchange="handleImageUpload(event)">
            <img id="image-preview" alt="é¢„è§ˆ">
        </div>
        
        <div class="editor-actions">
            <button class="btn btn-primary" id="upload-btn" onclick="uploadDiary()">
                ğŸ“¤ å‘å¸ƒæ—¥è®°
            </button>
            <button class="btn btn-secondary" onclick="clearEditor()">
                ğŸ—‘ï¸ æ¸…ç©º
            </button>
        </div>
        
        <div id="upload-status"></div>
    </div>

    <!-- æ—¥è®°ç»Ÿè®¡å’Œæœç´¢ -->
    <div class="diary-toolbar">
        <div class="stats-bar">
            <div class="stat-item">
                <span class="stat-icon">ğŸ“</span>
                <span class="stat-value" id="diary-count">0</span>
                <span class="stat-label">ç¯‡æ—¥è®°</span>
            </div>
            <div class="stat-item">
                <span class="stat-icon">ğŸ–¼ï¸</span>
                <span class="stat-value" id="image-count">0</span>
                <span class="stat-label">å¼ å›¾ç‰‡</span>
            </div>
            <div class="stat-item">
                <span class="stat-icon">ğŸ“…</span>
                <span class="stat-value" id="latest-date">-</span>
                <span class="stat-label">æœ€è¿‘æ›´æ–°</span>
            </div>
        </div>
        <div class="search-box">
            <input type="text" id="search-input" placeholder="ğŸ” æœç´¢æ—¥è®°..." onkeyup="searchDiaries()">
        </div>
    </div>

    <!-- æ—¥è®°åˆ—è¡¨ -->
    <div id="diary-list">
        <!-- åŠ¨æ€åŠ è½½çš„æ—¥è®°ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ -->
    </div>

    <!-- ç©ºçŠ¶æ€æç¤º -->
    <div class="empty-state" id="empty-state">
        <div class="empty-icon">ğŸ“”</div>
        <h3>è¿˜æ²¡æœ‰æ—¥è®°</h3>
        <p>ç‚¹å‡»å³ä¸‹è§’çš„ âœï¸ å¼€å§‹è®°å½•ä½ çš„ç¬¬ä¸€ç¯‡æ—¥è®°</p>
    </div>

</div>

<!-- æ‚¬æµ®æŒ‰é’® -->
<button class="fab" id="fab" onclick="toggleEditor()" title="å†™æ—¥è®°">âœï¸</button>

<footer>
    <p>âœ¦ <span>YSun ã® æ—¥è®°</span> âœ¦</p>
</footer>

<script>
    // ========== é…ç½® ==========
    const CORRECT_PASSWORD = "358966OoOo";
    const SESSION_KEY = "daynote_unlocked";
    const WORKER_URL = "https://diary-upload.3589665628.workers.dev";
    
    let currentEditId = null;
    let selectedImage = null;
    let deleteTargetId = null;
    let deleteTargetFileName = null;
    let deleteTargetSha = null;
    let allDiaries = []; // å­˜å‚¨æ‰€æœ‰æ—¥è®°ç”¨äºæœç´¢

    // ========== ä» GitHub åŠ è½½æ—¥è®° ==========
    async function loadDiariesFromGitHub() {
        showStatus('ğŸ“¡ æ­£åœ¨åŠ è½½æ—¥è®°...', 'loading');
        
        try {
            const response = await fetch(WORKER_URL + '/list', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ password: CORRECT_PASSWORD })
            });
            
            const result = await response.json();
            
            if (response.ok && result.success) {
                allDiaries = result.diaries;
                renderDiaryList(result.diaries);
                updateStats(result.diaries);
                hideStatus();
            } else {
                showStatus(`âš ï¸ ${result.error || 'åŠ è½½å¤±è´¥'}`, 'error');
            }
        } catch (error) {
            showStatus(`âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
        }
    }

    function renderDiaryList(diaries) {
        const container = document.getElementById('diary-list');
        const emptyState = document.getElementById('empty-state');
        
        container.innerHTML = '';
        
        if (diaries.length === 0) {
            emptyState.style.display = 'block';
            return;
        }
        
        emptyState.style.display = 'none';
        
        diaries.forEach(diary => {
            renderEntry(diary.id, diary.title, diary.content, diary.imageUrl, diary.date, false, diary.fileName, diary.id);
        });
    }

    function updateStats(diaries) {
        document.getElementById('diary-count').textContent = diaries.length;
        document.getElementById('image-count').textContent = diaries.filter(d => d.imageUrl).length;
        document.getElementById('latest-date').textContent = diaries[0]?.date || '-';
    }

    // ========== æœç´¢æ—¥è®° ==========
    function searchDiaries() {
        const query = document.getElementById('search-input').value.toLowerCase().trim();
        
        if (!query) {
            renderDiaryList(allDiaries);
            return;
        }
        
        const filtered = allDiaries.filter(d => 
            d.title.toLowerCase().includes(query) || 
            d.content.toLowerCase().includes(query)
        );
        
        renderDiaryList(filtered);
    }

    // ========== å¯†ç éªŒè¯ ==========
    if (sessionStorage.getItem(SESSION_KEY) === "true") {
        unlockPage();
    }

    function checkPassword() {
        const input = document.getElementById('password-input');
        const errorMsg = document.getElementById('error-msg');
        
        if (input.value === CORRECT_PASSWORD) {
            sessionStorage.setItem(SESSION_KEY, "true");
            unlockPage();
        } else {
            errorMsg.style.display = 'block';
            input.value = '';
            input.focus();
            
            const box = document.querySelector('.login-box');
            box.style.animation = 'shake 0.5s';
            setTimeout(() => box.style.animation = '', 500);
        }
    }

    function unlockPage() {
        const overlay = document.getElementById('password-overlay');
        const content = document.getElementById('main-content');
        const fab = document.getElementById('fab');
        
        overlay.style.opacity = '0';
        overlay.style.transition = 'opacity 0.5s';
        setTimeout(() => {
            overlay.style.display = 'none';
            content.classList.remove('locked');
            fab.style.display = 'block';
            // ä» GitHub åŠ è½½æ—¥è®°
            loadDiariesFromGitHub();
        }, 500);
    }

    // ========== ç¼–è¾‘å™¨ ==========
    let editorVisible = false;

    function toggleEditor() {
        const panel = document.getElementById('editor-panel');
        const fab = document.getElementById('fab');
        
        editorVisible = !editorVisible;
        panel.style.display = editorVisible ? 'block' : 'none';
        fab.classList.toggle('active', editorVisible);
        fab.textContent = editorVisible ? 'âœ•' : 'âœï¸';
        
        if (editorVisible) {
            document.getElementById('diary-title').focus();
            panel.scrollIntoView({ behavior: 'smooth', block: 'start' });
        } else {
            resetEditor();
        }
    }

    function resetEditor() {
        currentEditId = null;
        document.getElementById('editor-title').textContent = 'å†™æ–°æ—¥è®°';
        clearEditor();
    }

    function clearEditor() {
        document.getElementById('diary-title').value = '';
        document.getElementById('diary-content').value = '';
        clearImage();
        hideStatus();
    }

    // ========== å›¾ç‰‡ä¸Šä¼  ==========
    function handleImageUpload(event) {
        const file = event.target.files[0];
        if (!file) return;

        if (file.size > 5 * 1024 * 1024) {
            showStatus('âš ï¸ å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 5MB', 'error');
            return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
            selectedImage = e.target.result;
            const preview = document.getElementById('image-preview');
            preview.src = selectedImage;
            preview.style.display = 'block';
            document.getElementById('image-upload').classList.add('has-image');
        };
        reader.readAsDataURL(file);
    }

    function clearImage() {
        selectedImage = null;
        document.getElementById('image-preview').style.display = 'none';
        document.getElementById('image-preview').src = '';
        document.getElementById('image-input').value = '';
        document.getElementById('image-upload').classList.remove('has-image');
    }

    // ========== çŠ¶æ€æç¤º ==========
    function showStatus(message, type) {
        const status = document.getElementById('upload-status');
        status.textContent = message;
        status.className = type;
        status.style.display = 'block';
    }

    function hideStatus() {
        document.getElementById('upload-status').style.display = 'none';
    }

    // ========== æ—¥è®°æ“ä½œ ==========
    function toggleEntry(entry) {
        entry.classList.toggle('open');
    }

    function addNewEntry(title, content, imageUrl = null, fileName = null, sha = null) {
        const today = new Date().toISOString().split('T')[0];
        const id = sha || ('entry-' + Date.now());
        
        // æ·»åŠ åˆ°æœ¬åœ°æ•°ç»„
        allDiaries.unshift({ id, title, content, imageUrl, date: today, fileName, sha: id });
        updateStats(allDiaries);
        
        // æ¸²æŸ“åˆ°é¡µé¢
        renderEntry(id, title, content, imageUrl, today, true, fileName, id);
        
        // éšè—ç©ºçŠ¶æ€
        document.getElementById('empty-state').style.display = 'none';
    }

    function renderEntry(id, title, content, imageUrl, date, isNew = false, fileName = null, sha = null) {
        const container = document.getElementById('diary-list');
        
        const entry = document.createElement('div');
        entry.className = 'diary-entry' + (isNew ? ' new-entry open' : '');
        entry.dataset.id = id;
        entry.dataset.fileName = fileName || '';
        entry.dataset.sha = sha || '';
        
        const imageHtml = imageUrl 
            ? `<img src="${imageUrl}" class="entry-image" alt="æ—¥è®°å›¾ç‰‡" onclick="openLightbox('${imageUrl}')">`
            : `<div class="no-image-placeholder"><div class="icon">ğŸ“</div><p>çº¯æ–‡å­—è®°å½•</p></div>`;
        
        const imageTags = imageUrl 
            ? `<span class="entry-tag tag-has-image">æœ‰å›¾ç‰‡</span>` 
            : '';
        
        const newTag = isNew ? `<span class="entry-tag tag-new">åˆšåˆšå‘å¸ƒ</span>` : '';
        
        entry.innerHTML = `
            <div class="entry-header" onclick="toggleEntry(this.parentElement)">
                <div class="entry-info">
                    <div class="entry-title">
                        ${imageUrl ? '<span class="has-image"></span>' : ''}
                        ${title}
                    </div>
                    <div class="entry-meta">
                        <span class="entry-date">ğŸ“… ${date}</span>
                        ${newTag}
                        ${imageTags}
                    </div>
                </div>
                <span class="entry-toggle">+</span>
            </div>
            <div class="entry-content">
                <div class="entry-body">
                    ${imageHtml}
                    <div class="entry-text">
                        <p>${content.replace(/\n/g, '</p><p>')}</p>
                    </div>
                    <div class="entry-actions">
                        <button class="entry-btn entry-btn-delete" onclick="showDeleteModal('${id}', '${fileName || ''}', '${sha || ''}')">
                            ğŸ—‘ï¸ åˆ é™¤
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        if (isNew) {
            container.insertBefore(entry, container.firstChild);
        } else {
            container.appendChild(entry);
        }
    }

    function editEntry(id) {
        const entry = document.querySelector(`[data-id="${id}"]`);
        if (!entry) return;
        
        const title = entry.querySelector('.entry-title').textContent.trim();
        const content = entry.querySelector('.entry-text').textContent.trim();
        
        currentEditId = id;
        document.getElementById('editor-title').textContent = 'ç¼–è¾‘æ—¥è®°';
        document.getElementById('diary-title').value = title;
        document.getElementById('diary-content').value = content;
        
        if (!editorVisible) toggleEditor();
        document.getElementById('diary-title').focus();
    }

    // ========== åˆ é™¤åŠŸèƒ½ ==========
    function showDeleteModal(id, fileName, sha) {
        deleteTargetId = id;
        deleteTargetFileName = fileName;
        deleteTargetSha = sha;
        document.getElementById('delete-modal').style.display = 'flex';
    }

    function closeDeleteModal() {
        deleteTargetId = null;
        deleteTargetFileName = null;
        deleteTargetSha = null;
        document.getElementById('delete-modal').style.display = 'none';
    }

    async function confirmDelete() {
        if (!deleteTargetId) return;
        
        const entry = document.querySelector(`[data-id="${deleteTargetId}"]`);
        
        // å¦‚æœæœ‰ fileName å’Œ shaï¼Œè°ƒç”¨ GitHub API åˆ é™¤
        if (deleteTargetFileName && deleteTargetSha) {
            showStatus('ğŸ—‘ï¸ æ­£åœ¨åˆ é™¤...', 'loading');
            
            try {
                const response = await fetch(WORKER_URL + '/delete', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        fileName: deleteTargetFileName,
                        sha: deleteTargetSha,
                        password: CORRECT_PASSWORD
                    })
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                    showStatus('âœ… æ—¥è®°å·²åˆ é™¤', 'success');
                } else {
                    showStatus(`âŒ åˆ é™¤å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                showStatus(`âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            }
        }
        
        // ä»æœ¬åœ°æ•°ç»„åˆ é™¤
        allDiaries = allDiaries.filter(d => d.id !== deleteTargetId);
        updateStats(allDiaries);
        
        // ä»é¡µé¢åˆ é™¤
        if (entry) {
            entry.style.animation = 'fadeOut 0.3s forwards';
            setTimeout(() => entry.remove(), 300);
        }
        
        // æ£€æŸ¥æ˜¯å¦ä¸ºç©º
        if (allDiaries.length === 0) {
            document.getElementById('empty-state').style.display = 'block';
        }
        
        closeDeleteModal();
    }

    // ========== å›¾ç‰‡é¢„è§ˆåŠŸèƒ½ ==========
    function openLightbox(imageUrl) {
        const lightbox = document.getElementById('image-lightbox');
        const img = document.getElementById('lightbox-image');
        img.src = imageUrl;
        lightbox.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function closeLightbox() {
        document.getElementById('image-lightbox').style.display = 'none';
        document.body.style.overflow = '';
    }

    // ESC é”®å…³é—­é¢„è§ˆ
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeLightbox();
    });

    // ========== ä¸Šä¼ å›¾ç‰‡åˆ° GitHub ==========
    async function uploadImageToGitHub(base64Data) {
        showStatus('ğŸ–¼ï¸ æ­£åœ¨ä¸Šä¼ å›¾ç‰‡...', 'loading');
        
        try {
            const response = await fetch(WORKER_URL + '/image', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    imageData: base64Data,
                    password: CORRECT_PASSWORD
                })
            });
            
            const result = await response.json();
            
            if (response.ok && result.success) {
                return result.url;
            } else {
                throw new Error(result.error || 'å›¾ç‰‡ä¸Šä¼ å¤±è´¥');
            }
        } catch (error) {
            console.error('Image upload error:', error);
            return null;
        }
    }

    // ========== ä¸Šä¼ æ—¥è®° ==========
    async function uploadDiary() {
        const title = document.getElementById('diary-title').value.trim();
        const content = document.getElementById('diary-content').value.trim();
        const uploadBtn = document.getElementById('upload-btn');

        if (!title) {
            showStatus('âš ï¸ è¯·è¾“å…¥æ—¥è®°æ ‡é¢˜', 'error');
            document.getElementById('diary-title').focus();
            return;
        }
        if (!content) {
            showStatus('âš ï¸ è¯·è¾“å…¥æ—¥è®°å†…å®¹', 'error');
            document.getElementById('diary-content').focus();
            return;
        }

        uploadBtn.disabled = true;
        uploadBtn.textContent = 'â³ å‘å¸ƒä¸­...';
        
        let imageUrl = null;
        
        // å¦‚æœæœ‰å›¾ç‰‡ï¼Œå…ˆä¸Šä¼ åˆ° GitHub
        if (selectedImage) {
            showStatus('ğŸ–¼ï¸ æ­£åœ¨ä¸Šä¼ å›¾ç‰‡...', 'loading');
            imageUrl = await uploadImageToGitHub(selectedImage);
            if (!imageUrl) {
                showStatus('âš ï¸ å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼Œå°†å‘å¸ƒçº¯æ–‡å­—æ—¥è®°', 'error');
                await new Promise(r => setTimeout(r, 1500));
            }
        }
        
        showStatus('ğŸ“¡ æ­£åœ¨å‘å¸ƒæ—¥è®°...', 'loading');

        try {
            const response = await fetch(WORKER_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    title: title,
                    content: content,
                    imageUrl: imageUrl,
                    password: CORRECT_PASSWORD
                })
            });

            const result = await response.json();

            if (response.ok && result.success) {
                addNewEntry(title, content, imageUrl || selectedImage);
                toggleEditor();
                showStatus('âœ… å‘å¸ƒæˆåŠŸï¼åšå®¢å°†åœ¨å‡ åˆ†é’Ÿåæ›´æ–°', 'success');
            } else {
                showStatus(`âŒ å‘å¸ƒå¤±è´¥ï¼š${result.error || 'æœªçŸ¥é”™è¯¯'}`, 'error');
            }
        } catch (error) {
            showStatus(`âŒ ç½‘ç»œé”™è¯¯ï¼š${error.message}`, 'error');
        } finally {
            uploadBtn.disabled = false;
            uploadBtn.textContent = 'ğŸ“¤ å‘å¸ƒæ—¥è®°';
        }
    }

    // æ·»åŠ  CSS åŠ¨ç”»
    const style = document.createElement('style');
    style.textContent = `
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        @keyframes fadeOut {
            to { opacity: 0; transform: translateX(-50px); }
        }
    `;
    document.head.appendChild(style);
</script>
</body>
</html>